build:
  context: .
  dockerfile: Dockerfile

deploy:
  startCommand: >
    sh -c "
      echo 'ðŸ”„ Creating migrations...' &&
      python manage.py makemigrations &&
      python manage.py makemigrations authentication &&
      python manage.py makemigrations signalements &&
      echo 'ðŸ”„ Applying migrations...' &&
      python manage.py migrate &&
      echo 'ðŸ“Š Loading data...' &&
      python manage.py load_csv data/filtered-data-es.csv --force || true &&
      echo 'ðŸš€ Starting server...' &&
      gunicorn config.wsgi:application --bind 0.0.0.0:$PORT
    "
  healthcheckPath: /api/v1/installations/sports/
  healthcheckTimeout: 30
  restartPolicyType: always
