build:
  context: .
  dockerfile: Dockerfile

deploy:
  startCommand: >
    sh -c "
      echo 'ðŸ”„ DÃ©marrage des migrations...' &&
      python manage.py makemigrations authentication --name add_admin_fields &&
      python manage.py makemigrations signalements --name add_admin_management &&
      python manage.py migrate &&
      echo 'ðŸ“Š Import des donnÃ©es...' &&
      python manage.py load_csv data/filtered-data-es.csv --force || true &&
      echo 'ðŸš€ DÃ©marrage du serveur...' &&
      gunicorn config.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 120
    "
  healthcheckPath: /api/v1/installations/sports/
  healthcheckTimeout: 30
  restartPolicyType: always
